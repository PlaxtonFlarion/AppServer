<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>{{title}}</title>
<link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist/swagger-ui.css"/>

<style>
/* â€”â€”â€” æ ·å¼ä¿æŒå®Œæ•´ï¼Œä¸ä¾èµ– Python â€”â€”â€” */
:root {
  --bg:#0e0e0f; --fg:#f1f1f1; --panel:#171717; --border:#333; --code:#0e1117;
  --accent:#00e0ff; --sub:#9c9c9c;
}
.light { --bg:#fff; --fg:#111; --panel:#f7f7f7; --border:#ddd; --code:#f6f8fa; }

body{margin:0;display:flex;background:var(--bg);color:var(--fg);font-family:Inter,system-ui}
.sidebar{width:260px;background:var(--panel);height:100vh;position:fixed;overflow-y:auto;border-right:1px solid var(--border);padding:24px}
.logo{display:flex;align-items:center;gap:10px;font-size:20px;font-weight:700;margin-bottom:24px}
.logo img{height:28px;border-radius:6px}

#search{width:100%;padding:8px;margin-bottom:16px;background:var(--bg);color:var(--fg);border-radius:6px;border:1px solid var(--border)}

.section-title{opacity:.5;font-size:12px;font-weight:700;margin-top:16px;margin-bottom:6px}
.api-item{cursor:pointer;padding:6px;border-radius:6px;font-size:14px}
.api-item:hover{background:#ffffff18}
.method{background:var(--accent);color:#000;font-size:10px;padding:2px 5px;border-radius:4px;margin-right:6px;font-weight:900}

.content{margin-left:260px;padding:50px 60px}
h1{font-size:38px;font-weight:900;margin:0;background:linear-gradient(90deg,#00e0ff,#00ffa6);-webkit-background-clip:text;color:transparent}
.sub{opacity:.65;margin-bottom:30px}

details{background:var(--panel);margin-bottom:18px;padding:18px;border-radius:8px;border:1px solid var(--border)}
details summary{cursor:pointer;font-weight:800;font-size:16px;display:flex;gap:10px;margin-bottom:8px}

pre{background:var(--code);padding:12px;border-radius:6px;color:#c7c7c7;font-size:13px;overflow:auto}

.schema-box{padding-left:12px;border-left:3px solid var(--accent);margin-top:10px;margin-bottom:14px}
.schema-item{margin-left:12px;font-size:13px;padding:2px 0}
.schema-type{color:var(--accent);margin-left:6px}
.schema-required{color:#ff4d4d;margin-left:6px;font-size:11px;font-weight:800}
.schema-desc{opacity:.7;margin-left:6px;font-size:12px}

.btn-theme{position:fixed;right:20px;top:18px;padding:6px 12px;border-radius:6px;background:var(--panel);border:1px solid var(--border);cursor:pointer}
</style>
</head>

<body id="root">

<div class="sidebar">
  <div class="logo"><img src="{{logo}}"/> {{title}}</div>
  <input id="search" placeholder="Search API..."/>
  <div id="menu"></div>
</div>

<div class="content">
  <h1>{{title}}</h1>
  <div class="sub">âœ¨ API Reference Â· Example Â· JSON Schema Â· Auto Navigation</div>
  <div id="api"></div>
</div>

<div id="theme" class="btn-theme">ğŸŒ™ Dark</div>

<script>
const OPENAPI_URL = "{{openapi_url}}";

/* â€”â€”â€” ä¸»é¢˜åˆ‡æ¢ â€”â€”â€” */
let theme = localStorage.theme || "dark";
toggleTheme();
document.getElementById("theme").onclick=()=>{ theme=theme==="dark"?"light":"dark";localStorage.theme=theme;toggleTheme(); }
function toggleTheme(){ document.body.classList.toggle("light",theme==="light");document.getElementById("theme").innerText=theme==="light"?"ğŸŒ Light":"ğŸŒ™ Dark" }

/* â€”â€”â€” åŠ è½½ OpenAPI â€”â€”â€” */
fetch(OPENAPI_URL).then(r=>r.json()).then(buildUI);

function buildUI(spec){
  let groups={};
  Object.entries(spec.paths).forEach(([path,methods])=>{
    Object.entries(methods).forEach(([method,meta])=>{
      const tag=meta.tags?meta.tags[0]:"Others";
      (groups[tag]=groups[tag]||[]).push({path,method,meta});
    })
  });

  document.getElementById("menu").innerHTML =
    Object.entries(groups).map(([t,a])=>`
      <div class="section-title">${t}</div>
      ${a.map(e=>`<div class="api-item" onclick="jump('${e.path}')">
        <span class="method">${e.method}</span>${e.path}
      </div>`).join("")}
    `).join("");

  document.getElementById("api").innerHTML =
    Object.entries(groups).map(([t,a])=>`
       <h2 style="margin-top:32px;font-size:22px">${t}</h2>
       ${a.map(e=>renderAPI(e)).join("")}
    `).join("");
}

function renderAPI(ep){
  const req = ep.meta.requestBody?.content?.["application/json"]?.schema;
  const res = ep.meta.responses?.["200"]?.content?.["application/json"]?.schema;
  const schemaObj = req || res;

  return `
  <details>
    <summary><span class="method">${ep.method}</span><b>${ep.path}</b></summary>
    <p style="opacity:.75;margin:6px 0 12px">${ep.meta.summary||"No description"}</p>

    ${renderParams(ep.meta.parameters)}

    ${req?`<b>ğŸ“¥ Request Example</b><pre>${JSON.stringify(mock(req),null,2)}</pre>`:""}
    ${res?`<b>ğŸ“¤ Response Example</b><pre>${JSON.stringify(mock(res),null,2)}</pre>`:""}

    <details><summary>ğŸ§¬ JSON Schema</summary>
      <div class="schema-box">${renderSchema(schemaObj)}</div>
    </details>
  </details>`;
}

function renderParams(p){
  if(!p) return "";
  return `<b>ğŸ”§ Parameters</b><pre>${
    p.map(x=>`${x.name} (${x.in||"query"}) â†’ ${x.schema?.type||"any"}`).join("\n")
  }</pre>`;
}

/* â€”â€”â€” mock ç¤ºä¾‹ç”Ÿæˆ â€”â€”â€” */
function mock(s){
  if(s.example) return s.example;
  if(s.properties){
    let o={}; for(const k in s.properties)o[k]=mock(s.properties[k]); return o;
  }
  return s.type==="integer"?1:s.type==="number"?1.23:
         s.type==="boolean"?true:
         s.type==="array"?[mock(s.items)]: "string";
}

/* â€”â€”â€” Schema å±•å¼€æ ‘ â€”â€”â€” */
function renderSchema(s){
  if(!s||!s.properties) return "<i>No schema</i>";
  return Object.entries(s.properties).map(([k,v])=>{
    const req=(s.required||[]).includes(k);
    return v.properties ?
      `<details class="schema-item"><summary><b>${k}</b><span class="schema-type">${v.type}</span>${req?"<span class='schema-required'>required</span>":""}</summary><div class="schema-box">${renderSchema(v)}</div></details>` :
      `<div class="schema-item">â€¢ <b>${k}</b><span class="schema-type">${v.type}</span>${req?"<span class='schema-required'>required</span>":""}${v.description?`<span class="schema-desc">${v.description}</span>`:""}</div>`;
  }).join("");
}

/* â€”â€”â€” ä¾§è¾¹æ è·³è½¬ â€”â€”â€” */
function jump(p){
  document.querySelectorAll("details").forEach(el=>{
    if(el.innerText.includes(p)){ el.open=true; el.scrollIntoView({behavior:"smooth"}); }
  })
}

/* â€”â€”â€” æœç´¢è¿‡æ»¤ â€”â€”â€” */
document.getElementById("search").oninput=function(){
  const k=this.value.toLowerCase();
  document.querySelectorAll(".api-item").forEach(i=>{
    i.style.display=i.innerText.toLowerCase().includes(k)?"":"none";
  })
}
</script>
</body>
</html>
