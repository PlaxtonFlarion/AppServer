<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>AppServerX API</title>
<link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist/swagger-ui.css">

<style>
    :root{
      --bg:#0e0e0f;--fg:#fff;--panel:#171717;--border:#333;--code:#11131a;
      --accent:#00e0ff;--dim:#9d9d9d;
    }
    .light{--bg:#fff;--fg:#000;--panel:#f6f6f6;--border:#ccc;--code:#f4f5f7;}

    body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--fg);display:flex;height:100vh;}

    .sidebar{
      width:300px;
      background:var(--panel);
      border-right:1px solid var(--border);
      padding:26px;
      overflow-y:auto;
      position:fixed;
      height:calc(100vh - 0px);
      box-sizing:border-box;
      /* æ»šåŠ¨æ¡æ›´ç¾è§‚ */
      scrollbar-width:thin;
      scrollbar-color:var(--accent) transparent;
    }
    .sidebar::-webkit-scrollbar{width:6px;}
    .sidebar::-webkit-scrollbar-thumb{background:var(--accent);border-radius:4px;}
    .sidebar::-webkit-scrollbar-track{background:transparent;}

    .logo{display:flex;align-items:center;gap:10px;font-size:20px;font-weight:700;margin-bottom:22px;}
    .logo img{height:32px;border-radius:6px;}

    #search{
      width:100%;padding:8px;border-radius:6px;margin-bottom:14px;
      background:var(--bg);border:1px solid var(--border);color:var(--fg);
    }

    .section-title{opacity:.6;font-size:12px;font-weight:700;margin-top:16px;margin-bottom:6px}
    .api-item{padding:6px;border-radius:6px;font-size:14px;cursor:pointer}
    .api-item:hover{background:#ffffff14}
    .method{
      background:var(--accent);color:#000;padding:2px 6px;border-radius:4px;
      font-size:11px;font-weight:900;margin-right:6px;
    }

    .content{
      flex:1;margin-left:260px;padding:50px 60px;overflow-y:auto;
    }
    h1{
      font-size:38px;font-weight:900;margin:0;
      background:linear-gradient(90deg,#00e0ff,#00ffa6);
      -webkit-background-clip:text;color:transparent;
    }
    .sub{opacity:.65;margin-bottom:30px}

    details{
      background:var(--panel);border:1px solid var(--border);padding:18px;
      margin-bottom:20px;border-radius:8px;
    }
    details summary{
      cursor:pointer;font-size:16px;font-weight:800;
      margin-bottom:12px;display:flex;gap:8px;align-items:center;
    }

    h3{margin:14px 0 6px;}
    pre{
      background:var(--code);padding:12px;border-radius:8px;
      font-size:13px;color:#cfcfcf;overflow-x:auto;
    }
    hr{border:none;border-bottom:1px solid var(--border);margin:18px 0}

    .schema-box{padding-left:12px;border-left:3px solid var(--accent);margin-top:10px;margin-bottom:15px;}
    .schema-item{margin-left:12px;font-size:13px;padding:3px 0}
    .schema-type{color:var(--accent);margin-left:8px;font-size:12px;}
    .schema-required{color:#ff5454;font-size:11px;font-weight:700;margin-left:6px;}
    .schema-desc{opacity:.7;margin-left:6px;font-size:12px;}
    .btn-theme{
      position:fixed;right:20px;top:20px;padding:6px 12px;border-radius:6px;
      background:var(--panel);border:1px solid var(--border);cursor:pointer;
    }
</style>
</head>

<body id="root">

<div class="sidebar">
  <div class="logo"><img src="https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png"/>AppServerX</div>
  <input id="search" placeholder="Search API...">
  <div id="menu"></div>
</div>

<div class="content">
  <h1>AppServerX API</h1>
  <div class="sub">ğŸ“‘ Modern API Reference Â· Full Schema Â· Auto Example Generation</div>
  <div id="api"></div>
</div>

<div id="theme" class="btn-theme">ğŸŒ™ Dark</div>

<script>
    const OPENAPI_URL="openapi.json";
    let SPEC=null;

    /* å…¨å±€è¯·æ±‚å¤´ */
    const GLOBAL_HEADERS=[
      { key:"X-APP-ID", required:true, desc:"åº”ç”¨å”¯ä¸€æ ‡è¯†", example:"app_xxx" },
      { key:"X-APP-TOKEN", required:true, desc:"è®¿é—®é‰´æƒä»¤ç‰Œ", example:"token_xxx" }
    ];

    /* Theme */
    let theme=localStorage.theme||"dark";applyTheme();
    document.getElementById("theme").onclick=()=>{ theme=theme==="dark"?"light":"dark";localStorage.theme=theme;applyTheme(); }
    function applyTheme(){ document.body.classList.toggle("light",theme==="light"); document.getElementById("theme").innerText=theme==="light"?"ğŸŒ Light":"ğŸŒ™ Dark"; }

    /* Load API */
    fetch(OPENAPI_URL).then(r=>r.json()).then(spec=>{SPEC=spec;buildUI(spec)});

    /* ===== resolve $ref é€’å½’è§£æ ===== */
    function resolveRef(s){
      if(!s) return null;
      if(!s.$ref) return s;
      let name=s.$ref.replace("#/components/schemas/","");
      let real=SPEC.components?.schemas?.[name];
      return real ? resolveRef(real) : s;
    }

    /* ======================= build UI ======================= */
    function buildUI(spec){
      let groups={};
      Object.entries(spec.paths).forEach(([path,methods])=>{
        Object.entries(methods).forEach(([method,meta])=>{
          (groups[meta.tags?meta.tags[0]:"Others"] ||= []).push({path,method,meta});
        });
      });

      document.getElementById("menu").innerHTML=
        Object.entries(groups).map(([t,a])=>`
          <div class="section-title">${t}</div>
          ${a.map(e=>`<div class="api-item" onclick="jump('${e.path}')">
            <span class="method">${e.method}</span>${e.path}
          </div>`).join("")}
        `).join("");

      /* =========================ğŸ“Œ é¡¶éƒ¨å…¨å±€è¯·æ±‚å¤´å±•ç¤º ========================= */
      let globalHeaderHTML=`
      <details open style="margin-bottom:26px;">
        <summary style="font-size:18px;font-weight:900;cursor:pointer">
          ğŸ” Global Request Headers
        </summary>
        <div style="margin-top:12px;border-left:3px solid var(--accent);padding-left:14px;">
          ${GLOBAL_HEADERS.map(h=>`
          <div style="margin-bottom:10px;font-size:14px;">
            <b>${h.key}</b>
            ${h.required?`<span style="color:#ff4d4d;font-size:11px;margin-left:6px">required</span>`:""}
            <div style="opacity:.75;margin-left:4px">${h.desc}</div>
            <code style="padding:2px 6px;font-size:12px;background:#222;border-radius:4px;margin-left:4px;">
              Example: ${h.example}
            </code>
          </div>
          `).join("")}
        </div>
      </details>`;

      document.getElementById("api").innerHTML=
        globalHeaderHTML +
        Object.entries(groups).map(([t,a])=>`
          <h2 style="margin-top:35px;font-size:24px">${t}</h2>
          ${a.map(e=>renderAPI(e)).join("")}
        `).join("");
    }


    /* ======================æ¸²æŸ“æ¯ä¸ªæ¥å£====================== */
    function renderAPI(ep){
      const req=resolveRef(ep.meta.requestBody?.content?.["application/json"]?.schema);
      const res=resolveRef(ep.meta.responses?.["200"]?.content?.["application/json"]?.schema);
      const schema=req||res;

      return `
      <details>
        <summary><span class="method">${ep.method}</span><b>${ep.path}</b></summary>
        <p>${ep.meta.summary||""}</p>
        ${ep.meta.description?`<div style="opacity:.7;margin-bottom:10px">${ep.meta.description}</div>`:""}

        <!-- ğŸ”¥ æ·»åŠ å…¨å±€è¯·æ±‚å¤´å±•ç¤ºåˆ°æ¥å£å†…éƒ¨ -->
        <div style="margin:12px 0;border-left:3px solid var(--accent);padding-left:10px;">
          <b>ğŸ” Global Headers Applied</b>
          <pre style="margin-top:6px;">${
            GLOBAL_HEADERS.map(h=>`${h.key}: ${h.required?"(required)":""}`).join("\n")
          }</pre>
        </div>

        ${renderParams(ep.meta.parameters)}
        ${req?`<h3>ğŸ“¥ Request Example</h3><pre>${JSON.stringify(mock(req),null,2)}</pre>`:""}
        ${res?`<h3>ğŸ“¤ Response Example</h3><pre>${JSON.stringify(mock(res),null,2)}</pre>`:""}

        ${schema?`
          <details style="margin-top:10px">
          <summary>ğŸ§¬ JSON Schema</summary>
          <div class="schema-box">${renderSchema(schema)}</div>
          </details>`:""}
      </details>`;
    }


    /* params */
    function renderParams(p){
      if(!p) return "";
      return `
      <h3>ğŸ”§ Parameters</h3>
      <pre>${
        p.map(x=>`${x.name} (${x.in}) â†’ ${x.schema?.type||"any"} ${x.required?"[required]":""}`).join("\n")
      }</pre>`;
    }

    /* mock example */
    function mock(s){
      if(s.example) return s.example;
      if(s.default!==undefined) return s.default;
      if(s.enum) return s.enum[0];
      if(s.properties){let o={};for(const k in s.properties)o[k]=mock(s.properties[k]);return o;}
      if(s.items) return [mock(s.items)];
      return s.type==="integer"?1:s.type==="number"?1.23:s.type==="boolean"?true:"string"
    }

    /* schema */
    function renderSchema(s){
      if(!s?.properties) return "<i>No Schema</i>";
      return Object.entries(s.properties).map(([k,v])=>{
        v=resolveRef(v);
        return v.properties?
        `<details class="schema-item"><summary><b>${k}</b><span class="schema-type">${v.type}</span></summary><div class="schema-box">${renderSchema(v)}</div></details>`:
        `<div class="schema-item">â€¢ <b>${k}</b><span class='schema-type'>${v.type}</span></div>`;
      }).join("");
    }

    /* nav+search */
    function jump(p){document.querySelectorAll("details").forEach(el=>{if(el.innerText.includes(p)){el.open=true;el.scrollIntoView({behavior:"smooth"})}})}
    document.getElementById("search").oninput=function(){
      const k=this.value.toLowerCase();
      document.querySelectorAll(".api-item").forEach(i=>i.style.display=i.innerText.toLowerCase().includes(k)?"":"none");
    };
</script>

</body>
</html>
